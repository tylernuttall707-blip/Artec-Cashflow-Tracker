<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cash Flow Forecaster — 2025</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #60a5fa;
      --accent-2: #a78bfa;
      --danger: #ef4444;
      --ok: #22c55e;
      --warn: #eab308;
      --card: #0b1220;
      --border: #1f2937;
      --shadow: rgba(0,0,0,0.35);
      --glow1: rgba(96,165,250,0.08);
      --glow2: rgba(167,139,250,0.08);
      --tab-bg: #0b1220;
      --tab-active-bg: linear-gradient(180deg, #121a2c, #0c1424);
      --tab-active-border: #273244;
      --tab-active-ring: rgba(96,165,250,0.25);
      --input-bg: #0b1220;
      --table-head: #0f172a;
      --table-hover: rgba(96,165,250,0.06);
      --primary-bg: linear-gradient(180deg, rgba(96,165,250,0.2), rgba(96,165,250,0.1));
      --primary-border: rgba(96,165,250,0.35);
      --header-bg: linear-gradient(180deg, rgba(11,18,32,0.9), rgba(11,18,32,0.6));
      --chart-grid: rgba(255,255,255,0.08);
      --chart-axis: rgba(255,255,255,0.6);
    }
    body.light {
      --bg: #f8fafc;
      --panel: #ffffff;
      --muted: #64748b;
      --text: #0f172a;
      --accent: #2563eb;
      --accent-2: #7c3aed;
      --danger: #dc2626;
      --ok: #16a34a;
      --warn: #ca8a04;
      --card: #ffffff;
      --border: #d0d7e2;
      --shadow: rgba(15,23,42,0.08);
      --glow1: rgba(37,99,235,0.12);
      --glow2: rgba(124,58,237,0.12);
      --tab-bg: rgba(148,163,184,0.15);
      --tab-active-bg: linear-gradient(180deg, #ffffff, #e2e8f0);
      --tab-active-border: rgba(148,163,184,0.6);
      --tab-active-ring: rgba(37,99,235,0.25);
      --input-bg: #f1f5f9;
      --table-head: #e2e8f0;
      --table-hover: rgba(148,163,184,0.12);
      --primary-bg: linear-gradient(180deg, rgba(37,99,235,0.12), rgba(37,99,235,0.08));
      --primary-border: rgba(37,99,235,0.3);
      --header-bg: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
      --chart-grid: rgba(15,23,42,0.08);
      --chart-axis: rgba(15,23,42,0.6);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans,
      Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% 5%, var(--glow1), transparent 60%),
                  radial-gradient(1000px 600px at 90% 10%, var(--glow2), transparent 60%),
                  var(--bg);
      color: var(--text);
      color-scheme: dark;
    }
    body.light { color-scheme: light; }
    header {
      padding: 16px 20px;
      display: flex; align-items: center; gap: 16px; justify-content: space-between;
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(6px);
      position: sticky; top: 0; z-index: 10;
      background: var(--header-bg);
      flex-wrap: wrap;
    }
    .brand { display: flex; align-items: center; gap: 12px; }
    .logo { width: 28px; height: 28px; border-radius: 8px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow: 0 4px 20px var(--shadow); }
    h1 { font-size: 18px; margin: 0; letter-spacing: 0.3px; }
    .header-actions { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .tabs { display: flex; gap: 8px; flex-wrap: wrap; }
    .tab-btn {
      background: var(--tab-bg);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 12px; border-radius: 10px;
      cursor: pointer; transition: all 0.15s ease;
    }
    .tab-btn.active { background: var(--tab-active-bg); border-color: var(--tab-active-border); box-shadow: inset 0 0 0 1px var(--tab-active-ring); }
    .theme-toggle {
      background: var(--tab-bg);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 999px;
      padding: 6px 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: box-shadow 0.2s ease, background 0.2s ease;
    }
    .theme-toggle:hover { box-shadow: 0 6px 20px var(--shadow); }
    .theme-toggle:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
    main { padding: 20px; max-width: 1200px; margin: 0 auto; }
    section.tab { display: none; }
    section.tab.active { display: block; }

    .grid { display: grid; gap: 16px; }
    .grid.cols-3 { grid-template-columns: repeat(3, minmax(0,1fr)); }
    .grid.cols-2 { grid-template-columns: repeat(2, minmax(0,1fr)); }
    @media (max-width: 900px) { .grid.cols-3 { grid-template-columns: 1fr; } }
    @media (max-width: 700px) { .grid.cols-2 { grid-template-columns: 1fr; } }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 8px 24px var(--shadow);
    }
    .card h3 { margin-top: 0; font-size: 14px; color: var(--muted); font-weight: 600; letter-spacing: 0.3px; }
    .kpi { font-size: 28px; font-weight: 700; margin: 4px 0 2px 0; }
    .sub { color: var(--muted); font-size: 12px; }

    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    label.small { font-size: 12px; color: var(--muted); }
    input, select, textarea {
      background: var(--input-bg); color: var(--text);
      border: 1px solid var(--border); border-radius: 10px;
      padding: 8px 10px; outline: none;
    }
    input[type="date"] { padding: 6px 10px; }
    input[type="number"] { width: 140px; }
    button.primary {
      background: var(--primary-bg);
      border: 1px solid var(--primary-border);
      color: var(--text); border-radius: 10px; padding: 8px 12px; cursor: pointer;
    }
    button.ghost {
      background: transparent; border: 1px dashed var(--border); color: var(--muted); border-radius: 10px; padding: 8px 12px; cursor: pointer;
    }
    button.danger { background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.35); }
    button.warn { background: rgba(234,179,8,0.15); border: 1px solid rgba(234,179,8,0.35); }

    table {
      width: 100%; border-collapse: collapse; font-size: 14px; overflow: hidden; border-radius: 10px;
    }
    th, td { border-bottom: 1px solid var(--border); padding: 8px 10px; text-align: left; }
    thead th { background: var(--table-head); position: sticky; top: 0; z-index: 1; }
    tbody tr:hover { background: var(--table-hover); }
    .right { text-align: right; }

    .chart-wrap { height: 300px; width: 100%; }
    .chart { width: 100%; height: 100%; }
    .muted { color: var(--muted); }

    .pill { display:inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; border: 1px solid var(--border); }
    .income { color: var(--ok); border-color: rgba(34,197,94,0.4); }
    .expense { color: var(--danger); border-color: rgba(239,68,68,0.4); }
    .note { color: var(--muted); }

    .spacer { height: 10px; }

    .footer { color: var(--muted); font-size: 12px; text-align:center; padding: 12px; }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Cash Flow Forecaster — 2025</h1>
        <div class="sub">Local-only • Single-file • Offline ready</div>
      </div>
    </div>
    <div class="header-actions">
      <div class="tabs">
        <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
        <button class="tab-btn" data-tab="expenses">Expenses / One-offs</button>
        <button class="tab-btn" data-tab="income">Income</button>
      </div>
      <button class="theme-toggle" id="toggleTheme" type="button" aria-pressed="false">☀️ Light mode</button>
    </div>
  </header>

  <main>
    <!-- DASHBOARD -->
    <section class="tab active" id="dashboard">
      <div class="grid cols-3">
        <div class="card">
          <h3>Settings</h3>
          <div class="row">
            <label class="small">Start Balance</label>
            <input id="startBalance" type="number" step="0.01" placeholder="0.00"/>
            <label class="small">Start Date</label>
            <input id="startDate" type="date"/>
            <label class="small">End Date</label>
            <input id="endDate" type="date"/>
            <button class="primary" id="saveSettings">Save</button>
          </div>
          <div class="spacer"></div>
          <div class="row">
            <button class="ghost" id="exportJSON">Export JSON</button>
            <input id="importJSONInput" type="file" accept="application/json" style="display:none" />
            <button class="ghost" id="importJSON">Import JSON</button>
            <button class="ghost" id="exportCSV">Export Daily CSV</button>
            <input id="importCSVInput" type="file" accept=".csv,text/csv" style="display:none" />
            <button class="ghost" id="importCSV">Import CSV</button>
            <button class="warn" id="clearData">Reset All</button>
          </div>
          <div class='row'><button class='primary' id='useEmbeddedCSV'>Import the CSV you attached</button><span class='muted'>We embedded your file — map its columns after clicking.</span></div>
        </div>
        <div class="card">
          <h3>Projection</h3>
          <div class="kpi" id="kpiToday">$0</div>
          <div class="sub">Projected balance as of today</div>
          <div class="spacer"></div>
          <div class="kpi" id="kpiEOY">$0</div>
          <div class="sub">Projected balance on End Date</div>
        </div>
        <div class="card">
          <h3>Totals</h3>
          <div class="row">
            <div>
              <div class="kpi" id="kpiInflows">$0</div>
              <div class="sub">Total inflows within range</div>
            </div>
            <div>
              <div class="kpi" id="kpiOutflows">$0</div>
              <div class="sub">Total outflows within range</div>
            </div>
          </div>
          <div class="spacer"></div>
          <h3>Adjustments</h3>
          <div class="row">
            <input id="adjDate" type="date"/>
            <input id="adjAmount" type="number" step="0.01" placeholder="+/- amount"/>
            <input id="adjMemo" type="text" placeholder="Memo (optional)"/>
            <button class="primary" id="addAdj">Add</button>
          </div>
          <div class="spacer"></div>
          <div style="max-height:150px; overflow:auto;">
            <table id="adjTable">
              <thead><tr><th>Date</th><th class="right">Amount</th><th>Memo</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="spacer"></div>

      <div class="card">
        <h3>Balance Curve</h3>
        <div class="chart-wrap"><svg id="balanceChart" class="chart" viewBox="0 0 800 300" preserveAspectRatio="none"></svg></div>
      </div>

      <div class="spacer"></div>

      <div class="card">
        <h3>Next 60 days (net & notable)</h3>
        <div style="max-height:260px; overflow:auto;">
          <table id="upcomingTable">
            <thead>
              <tr><th>Date</th><th class="right">Inflows</th><th class="right">Outflows</th><th class="right">Net</th><th class="right">Balance</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="footer">Pro tip: everything autosaves to your browser only. No servers, no sync.</div>
    </section>

    <!-- EXPENSES / ONE-OFFS -->
    <section class="tab" id="expenses">
      <div class="card">
        <h3>Add one-off item</h3>
        <div class="row">
          <input id="txDate" type="date"/>
          <select id="txType">
            <option value="expense">Expense</option>
            <option value="income">Income (big payment)</option>
          </select>
          <input id="txAmount" type="number" step="0.01" placeholder="Amount"/>
          <input id="txCategory" type="text" placeholder="Category"/>
          <input id="txMemo" type="text" placeholder="Memo (optional)"/>
          <button class="primary" id="addTx">Add</button>
        </div>
      </div>

      <div class="spacer"></div>

      <div class="card">
        <h3>One-offs</h3>
        <div style="max-height:400px; overflow:auto;">
          <table id="txTable">
            <thead>
              <tr><th>Date</th><th>Type</th><th class="right">Amount</th><th>Category</th><th>Memo</th><th></th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- INCOME -->
    <section class="tab" id="income">
      <div class="grid cols-2">
        <div class="card">
          <h3>Recurring weekly income</h3>
          <div class="row">
            <input id="recCat" type="text" placeholder="Category (e.g., Sales A)"/>
            <input id="recAmt" type="number" step="0.01" placeholder="Weekly Amount"/>
            <select id="recDist">
              <option value="even">Evenly across week</option>
              <option value="days">On selected weekdays</option>
            </select>
            <div class="row" id="weekdayPicker" style="display:none">
              <label class="small">Days:</label>
              <label><input type="checkbox" class="wd" value="1">Mon</label>
              <label><input type="checkbox" class="wd" value="2">Tue</label>
              <label><input type="checkbox" class="wd" value="3">Wed</label>
              <label><input type="checkbox" class="wd" value="4">Thu</label>
              <label><input type="checkbox" class="wd" value="5">Fri</label>
              <label><input type="checkbox" class="wd" value="6">Sat</label>
              <label><input type="checkbox" class="wd" value="0">Sun</label>
            </div>
            <button class="primary" id="addRec">Add</button>
          </div>
          <div class="spacer"></div>
          <div style="max-height:300px; overflow:auto;">
            <table id="recTable">
              <thead><tr><th>Category</th><th class="right">Weekly</th><th>Distribution</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <h3>Daily expected income</h3>
          <div class="row">
            <input id="dIncDate" type="date"/>
            <input id="dIncAmt" type="number" step="0.01" placeholder="Amount"/>
            <input id="dIncCat" type="text" placeholder="Category"/>
            <input id="dIncMemo" type="text" placeholder="Memo (optional)"/>
            <button class="primary" id="addDInc">Add</button>
          </div>
          <div class="spacer"></div>
          <div style="max-height:300px; overflow:auto;">
            <table id="dIncTable">
              <thead><tr><th>Date</th><th class="right">Amount</th><th>Category</th><th>Memo</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script src="/app.js"></script>
</body>
</html>
